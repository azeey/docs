<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Physics">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Physics: &quot;Use custom engine with Ignition Physics&quot;</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Physics</h1>
        <h2>API Reference</h2>
        <div class="version">
        5.3.2
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 IgnCreateDocs.cmake -->
      <nav class="ign-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">"Use custom engine with Ignition Physics" </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md65"></a>
Prerequisites</h2>
<p>In the previous tutorial <a class="el" href="installation.html">Installation</a>, you have installed the Ignition Physics corresponding to the desired Ignition release.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
How to adapt a physics engine as a plugin in Ignition Physics</h2>
<p>In the last <a class="el" href="createphysicsplugin.html">Implement a physics plugin</a> tutorial, we know how to implement a dummy physics engine as a plugin and load it using <a class="el" href="namespaceignition_1_1physics.html">Ignition Physics API</a>. In <a class="el" href="createcustomfeature.html">Implement a custom feature</a> tutorial, we know how to define and implement a custom feature in an existing <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/dartsim">DART</a> physics plugin. This tutorial will explain step-by-step how to use any physics engine with Ignition Physics. We will use <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> as an example for this tutorial.</p>
<h3><a class="anchor" id="autotoc_md67"></a>
General structure of a physics plugin</h3>
<p>As described in <a class="el" href="createcustomfeature.html">Implement a custom feature</a> tutorial, the plugin folder is placed just below the top-level folder of <code>ign-physics</code>. In general, any physics plugin folder will have the following structure, which is commented in detail:</p>
<div class="fragment"><div class="line">tpe</div>
<div class="line">├── lib                              Main physics engine implementation.</div>
<div class="line">│    ├── src</div>
<div class="line">│    ├── CMakeLists.txt              CMake build script for physics engine implementation.</div>
<div class="line">├── plugin                           Main implementation of the plugin features interfacing the physics engines API</div>
<div class="line">│    ├── src</div>
<div class="line">│    |     ├── plugin.cc             Main file for the plugin declaration and plugin registering.</div>
<div class="line">│    |     ├── &lt;FEATURES&gt;.hh         The FeatureList header file.</div>
<div class="line">│    |     ├── &lt;FEATURES&gt;.cc         Implementation of the FeatureList, which adapts to functions implemented in lib used in the FeatureList.</div>
<div class="line">│    |     ├── &lt;FEATURES_TEST&gt;.cc    Test cases for the FeatureList.</div>
<div class="line">│    ├── worlds                      Example SDF files for testing plugin functionalities.</div>
<div class="line">│    ├── CMakeLists.txt              CMake build script for the plugin features.</div>
<div class="line">└── CMakeLists.txt                   CMake build script for the plugin.</div>
</div><!-- fragment --><p>Note that the <code>lib</code> folder is optionally placed inside the physics plugin folder depending on the design target, we can link the external physics engine library in <code>CMakeLists.txt</code> of the plugin, assuming the physics engine library is already installed. In our case, <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> is natively developed inside Ignition Physics and hence the <code>lib</code> folder.</p>
<p>We declare and implement the <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> interfacing with the physics engine API inside <code>plugin\src</code> folder (please see <a class="el" href="createcustomfeature.html">Implement a custom feature</a> for the plugin feature requirements). Depending on design target, a <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> is generally a packing of related <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a>. For example in TPE's <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/EntityManagementFeatures.hh">EntityManagementFeatures</a> , there are <a class="el" href="classignition_1_1physics_1_1GetEngineInfo.html">GetEngineInfo</a>, <a class="el" href="classignition_1_1physics_1_1GetWorldFromEngine.html">GetWorldFromEngine</a>, etc. features defined in the "FeatureList" structure for entity management purpose.</p>
<p>Conventionally, a <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> can be implemented as:</p><ul>
<li><code>&lt;FEATURES&gt;.hh</code> for the "FeatureList" declaration.</li>
<li><code>&lt;FEATURES&gt;.cc</code> for the "FeatureList" implementation corresponding to each of the <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a> member functions, using the physics engine API to realize the feature behavior. For a list of common pre-defined features in Ignition Physics, please refer to <a class="el" href="physicsplugin.html">Understanding the Physics Plugin</a> tutorial.</li>
<li><code>&lt;FEATURES_TEST&gt;.cc</code> for unit tests of the "FeatureList".</li>
</ul>
<h3><a class="anchor" id="autotoc_md68"></a>
Main plugin.cc file</h3>
<p>In this tutorial, we will show how to construct a simple simulation world using <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> physics engine. For this purpose, we will implement the pre-defined <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> and include this feature into an empty <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> named <code>EntityManagementFeatureList</code> defined in <code>EntityManagementFeatures.hh</code>. We first include the <code>EntityManagementFeatureList</code> in <code>plugin.cc</code> main file and register the example TPE physics plugin as follow:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2Register_8hh.html">ignition/physics/Register.hh</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;Base.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;EntityManagementFeatures.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceignition.html">ignition</a> {</div>
<div class="line"><span class="keyword">namespace </span>physics {</div>
<div class="line"><span class="keyword">namespace </span>tpeplugin {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>TpePluginFeatures : FeatureList&lt;</div>
<div class="line">  EntityManagementFeatureList</div>
<div class="line">&gt; { };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Plugin :</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a>&lt;TpePluginFeatures&gt;,</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> Base,</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> EntityManagementFeatures { };</div>
<div class="line"> </div>
<div class="line"><a class="code" href="gz_2physics_2Register_8hh.html#a983192a469b717a9c981c80aaa971aae">IGN_PHYSICS_ADD_PLUGIN</a>(Plugin, <a class="code" href="namespaceignition_1_1physics.html#a7f245b484b6675dbb78f5b1aa68790b2">FeaturePolicy3d</a>, TpePluginFeatures)</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p>In general, there are 3 steps for <code>plugin.cc</code>:</p><ul>
<li>Define the final <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> including all required "FeatureLists". In TPE case, it is <code>TpePluginFeatures</code>.</li>
<li>Define an empty class inherited all "FeatureLists" class, <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/Base.hh">Base</a> class (optionally depending on software design) and <a class="el" href="namespaceignition_1_1physics.html#a2d96f4e9c1426d8a61da147434b61d66">Implements</a> class implementing <a class="el" href="structignition_1_1physics_1_1FeaturePolicy.html">FeaturePolicy</a> 2D or 3D and different scalar type.</li>
<li>Register the physics plugin using <code>IGN_PHYSICS_ADD_PLUGIN</code> macro (See <a class="el" href="createphysicsplugin.html">Implement a physics plugin</a> for more detail).</li>
</ul>
<h3><a class="anchor" id="autotoc_md69"></a>
Implement a feature using TPE's API</h3>
<p>Now we assume that we have not implemented any <a class="el" href="classignition_1_1physics_1_1Feature.html">Feature</a> for <code>TPE</code>. In the <code>plugin</code> folder, we will create two files <code>EntityManagementFeatures.hh</code> and <code>EntityManagementFeatures.cc</code> to implement <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> in <code>EntityManagementFeatures</code> "FeatureList". The unit test for this feature is also worth implemented in <code>EntityManagement_TEST.cc</code>. Please download the example <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/CMakeLists.txt">CMakeLists.txt</a> and <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/Base.hh">Base.hh</a> into <code>plugin</code> folder by:</p>
<div class="fragment"><div class="line">wget https://raw.githubusercontent.com/ignitionrobotics/ign-physics/main/tpe/plugin/CMakeLists.txt -P &lt;path-to-ign-physics&gt;/tpe/plugin/</div>
<div class="line">wget https://raw.githubusercontent.com/ignitionrobotics/ign-physics/main/tpe/plugin/src/Base.hh -P &lt;path-to-ign-physics&gt;/tpe/plugin/src</div>
</div><!-- fragment --><p>Now the folder structure looks like this:</p>
<div class="fragment"><div class="line">tpe</div>
<div class="line">├── lib</div>
<div class="line">├── plugin</div>
<div class="line">│    ├── src</div>
<div class="line">│    |     ├── plugin.cc</div>
<div class="line">│    |     ├── Base.hh</div>
<div class="line">│    |     ├── EntityManagementFeatures.hh</div>
<div class="line">│    |     ├── EntityManagementFeatures.cc</div>
<div class="line">│    |     ├── EntityManagement_TEST.cc</div>
<div class="line">│    ├── CMakeLists.txt</div>
<div class="line">└── CMakeLists.txt</div>
</div><!-- fragment --><p>Basically, <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> has a subclass <a class="el" href="classignition_1_1physics_1_1Feature_1_1Engine.html">Engine</a> defining <code>ConstructEmptyWorld</code> member function. The feature implementation is shown as below:</p>
<p><a class="anchor" id="autotoc_md70"></a></p><h5>EntityManagementFeatures.hh:</h5>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef IGNITION_PHYSICS_TPE_PLUGIN_SRC_GETENTITIESFEATURE_HH_</span></div>
<div class="line"><span class="preprocessor">#define IGNITION_PHYSICS_TPE_PLUGIN_SRC_GETENTITIESFEATURE_HH_</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2ConstructEmpty_8hh.html">ignition/physics/ConstructEmpty.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2Shape_8hh.html">ignition/physics/Shape.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2GetEntities_8hh.html">ignition/physics/GetEntities.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2RemoveEntities_8hh.html">ignition/physics/RemoveEntities.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2Implements_8hh.html">ignition/physics/Implements.hh</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;Base.hh&quot;</span> <span class="comment">// optionally depending on software design</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceignition.html">ignition</a> {</div>
<div class="line"><span class="keyword">namespace </span>physics {</div>
<div class="line"><span class="keyword">namespace </span>tpeplugin {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>EntityManagementFeatureList : FeatureList&lt;</div>
<div class="line">  ConstructEmptyWorldFeature</div>
<div class="line">&gt; { };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>EntityManagementFeatures :</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> Base,</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a>&lt;EntityManagementFeatureList&gt;</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// ----- Construct empty entities -----</span></div>
<div class="line">  <span class="keyword">public</span>: Identity ConstructEmptyWorld(</div>
<div class="line">    <span class="keyword">const</span> Identity &amp;_engineID, <span class="keyword">const</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> &amp;_name) <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>Together with other (if existing) <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a>, the <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> is included in <code>EntityManagementFeatureList</code> "FeatureList" to declare the related features for entity management purpose.</p>
<p>The <code>EntityManagementFeatures</code> "FeatureList" here inherits from:</p><ul>
<li>(optionally) Base class for foundation metadata definitions of Models, Joints, Links, and Shapes objects of TPE to provide easy access to <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe/lib">tpelib</a> structures in the TPE library. Note that we mention <code>Base</code> class here for completeness, <code>Base</code> class is not necessarily needed if there is a straightforward way to interface external physics engine class objects with <code>ign-physics</code> class objects.</li>
<li><a class="el" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a> for implementing the custom feature with <a class="el" href="namespaceignition_1_1physics.html#a7f245b484b6675dbb78f5b1aa68790b2">FeaturePolicy3d</a> ("FeaturePolicy" of 3 dimensions and scalar type <code>double</code>).</li>
</ul>
<p><a class="anchor" id="autotoc_md71"></a></p><h5>EntityManagementFeatures.cc:</h5>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;EntityManagementFeatures.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceignition.html">ignition</a>;</div>
<div class="line"><span class="keyword">using namespace </span>physics;</div>
<div class="line"><span class="keyword">using namespace </span>tpeplugin;</div>
<div class="line"> </div>
<div class="line">Identity EntityManagementFeatures::ConstructEmptyWorld(</div>
<div class="line">  <span class="keyword">const</span> Identity &amp;, <span class="keyword">const</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> &amp;_name)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">auto</span> world = std::make_shared&lt;tpelib::World&gt;();</div>
<div class="line">  world-&gt;SetName(_name);</div>
<div class="line">  <span class="keywordflow">return</span> this-&gt;AddWorld(world);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here we show the overriding of <code>ConstructEmptyWorld</code> member function of <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a>, this is where we use the physics engine API to implement this member function. We simply instantiate World object, set the world name and call AddWorld function which was defined in <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/Base.hh">Base.hh</a>.</p>
<p><a class="anchor" id="autotoc_md72"></a></p><h5>EntityManagement_TEST.cc:</h5>
<p>Simple unit tests are good practice for sanity checks. While we won't go into detail, here is an example to test our new <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ignition/plugin/Loader.hh&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ignition_2physics_2RequestEngine_8hh.html">ignition/physics/RequestEngine.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;EntityManagementFeatures.hh&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>TestFeatureList : <a class="code" href="structignition_1_1physics_1_1FeatureList.html">ignition::physics::FeatureList</a>&lt;</div>
<div class="line">  ignition::physics::tpeplugin::EntityManagementFeatureList</div>
<div class="line">&gt; { };</div>
<div class="line"> </div>
<div class="line">TEST(EntityManagement_TEST, ConstructEmptyWorld)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1Loader.html">ignition::plugin::Loader</a> loader;</div>
<div class="line">  loader.<a class="codeRef" href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1Loader.html#a78b2ddd492810b5120ad19bc708aa137">LoadLib</a>(tpe_plugin_LIB);</div>
<div class="line"> </div>
<div class="line">  <a class="codeRef" href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1TemplatePluginPtr.html">ignition::plugin::PluginPtr</a> tpe_plugin =</div>
<div class="line">    loader.<a class="codeRef" href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1Loader.html#a38af38708f58ad09a98603ed08fdb33c">Instantiate</a>(<span class="stringliteral">&quot;ignition::physics::tpeplugin::Plugin&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> engine =</div>
<div class="line">      <a class="code" href="structignition_1_1physics_1_1RequestEngine.html#aa04799d42bf6171a8e5cb7e83c631aaa">ignition::physics::RequestEngine3d&lt;TestFeatureList&gt;::From</a>(tpe_plugin);</div>
<div class="line">  <span class="keyword">auto</span> world = engine-&gt;ConstructEmptyWorld(<span class="stringliteral">&quot;empty world&quot;</span>);</div>
<div class="line">  ASSERT_NE(<span class="keyword">nullptr</span>, world);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  ::testing::InitGoogleTest(&amp;argc, argv);</div>
<div class="line">  <span class="keywordflow">return</span> RUN_ALL_TESTS();</div>
<div class="line">}</div>
</div><!-- fragment --><p>Please take a look at <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/EntityManagement_TEST.cc">EntityManagement_TEST.cc</a> for more comprehensive unit tests.</p>
<h2><a class="anchor" id="autotoc_md73"></a>
Build the custom physics plugin</h2>
<p>Please follow the previous tutorial <a class="el" href="installation.html">Installation</a> to build <code>ign-physics</code> from source again for our new feature to be compiled.</p>
<p>Now we can load the new physics plugin named <code>ignition-physics-tpe-plugin</code> to test it on Ignition Gazebo by following this <a class="el" href="switchphysicsengines.html">Switching physics engines</a> tutorial.</p>
<h2><a class="anchor" id="autotoc_md74"></a>
Prerequisites</h2>
<ul>
<li><a class="el" href="installation.html">Installation</a></li>
<li><a class="el" href="physicsplugin.html">Understand physics plugin</a></li>
<li><a class="el" href="physicsengine.html">Use different physics engines</a></li>
<li>Load physics plugin</li>
<li>Implement custom feature</li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
How to interface with physics engine</h2>
<p>In the previous Implement custom feature tutorial, we walked through how to define and implement a custom feature using an already supported physics engine. This tutorial will explain step-by-step how to interface with any physics engine using Ignition Physics. We will use <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> as an example in this tutorial.</p>
<h3><a class="anchor" id="autotoc_md76"></a>
Structure of a physics plugin</h3>
<p>Depending on what physics engine you would like to use, the folder structure could be slightly different from what's shown below. Here's the plugin folder structure of TPE, within the Ignition Physics library.</p>
<div class="fragment"><div class="line">ign-physics</div>
<div class="line">├── tpe</div>
<div class="line">│   ├── plugin                           Implementation of the plugin features interfacing the physics engines API</div>
<div class="line">│   │    ├── src</div>
<div class="line">│   │    |     ├── plugin.cc             Main file for the plugin declaration and plugin registering.</div>
<div class="line">│   │    |     ├── &lt;FEATURES&gt;.hh         The FeatureList header file.</div>
<div class="line">│   │    |     ├── &lt;FEATURES&gt;.cc         Implementation of the FeatureList using physics engine API</div>
<div class="line">│   │    |     └── &lt;FEATURES_TEST&gt;.cc    Tests</div>
<div class="line">│   │    └── CMakeLists.txt              CMake build script for the plugin features.</div>
<div class="line">│   └── CMakeLists.txt                   CMake build script for the plugin.</div>
<div class="line">└── CMakeList.txt                        CMake build script for Ignition Physics library.</div>
</div><!-- fragment --><p>We link the external physics engine library in <code>CMakeLists.txt</code> of the plugin, assuming the physics engine library is already installed. In our case, <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> is placed inside Ignition Physics and hence there is a <code>lib</code> folder under <code>tpe</code>.</p>
<p>We declare and implement the <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> interfacing with the physics engine API inside <code>plugin/src</code> folder (please see Implement custom feature for the plugin feature requirements). Depending on design target, a <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> is generally a packing of related <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a>. For example in TPE's <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/EntityManagementFeatures.hh">EntityManagementFeatures</a> , there are <a class="el" href="classignition_1_1physics_1_1GetEngineInfo.html">GetEngineInfo</a>, <a class="el" href="classignition_1_1physics_1_1GetWorldFromEngine.html">GetWorldFromEngine</a>, etc. features defined in the "FeatureList" structure for entity management purpose.</p>
<p>Conventionally, a <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> can be implemented as:</p><ul>
<li><code>&lt;FEATURES&gt;.hh</code> for the "FeatureList" declaration.</li>
<li><code>&lt;FEATURES&gt;.cc</code> for the "FeatureList" implementation corresponding to each of the <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a> member functions, using the physics engine API to realize the feature behavior. For a list of common pre-defined features in Ignition Physics, please refer to <a class="el" href="physicsplugin.html">Understand physics plugin</a> tutorial.</li>
<li><code>&lt;FEATURES_TEST&gt;.cc</code> for unit tests of the "FeatureList".</li>
</ul>
<p>Next, we will use a simplified TPE plugin example to explain important components needed to interface with any physics engine. All code examples used below can be downloaded from <a href="https://github.com/ignitionrobotics/ign-physics/tree/ign-physics2/examples">examples</a> under the <code>simple_plugin</code> folder:</p>
<div class="fragment"><div class="line">simple_plugin</div>
<div class="line">├── CMakeLists.txt</div>
<div class="line">├── plugin.cc</div>
<div class="line">├── EntityManagementFeatures.hh</div>
<div class="line">├── EntityManagementFeatures.cc</div>
<div class="line">└── EntityManagementFeatures_TEST.cc</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md77"></a>
&lt;tt&gt;plugin.cc&lt;/tt&gt;</h3>
<p>In this tutorial, we will show how to construct a simple simulation world using <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> physics engine. For this purpose, we will implement the pre-defined <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> and include this feature into an empty <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> named <code>EntityManagementFeatureList</code> defined in <code>EntityManagementFeatures.hh</code>. We first include the <code>EntityManagementFeatureList</code> in <code>plugin.cc</code> main file and register the example TPE physics plugin as follow:</p>
<div class="fragment"></div><!-- fragment --><p> Those are 3 things needed to be specified in <code>plugin.cc</code>:</p><ul>
<li>Define the conclusive <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> including all required "FeatureLists" and <code>Base</code> class. In TPE case, it is <code>TpePluginFeatures</code>.</li>
<li>Define the dimension of the simulation, ex. <a class="el" href="namespaceignition_1_1physics.html#a2d96f4e9c1426d8a61da147434b61d66">Implements</a> class implementing <a class="el" href="structignition_1_1physics_1_1FeaturePolicy.html">FeaturePolicy</a> 2D or 3D and different scalar type.</li>
<li>Register the physics plugin using <code>IGN_PHYSICS_ADD_PLUGIN</code> macro (See Implement physics plugin for more detail).</li>
</ul>
<h3><a class="anchor" id="autotoc_md78"></a>
Implement features with physics engine's API</h3>
<p>Now we would like to implement the <code>EntityManagementFeatures</code>. In the <code>simple_plugin</code> folder, we will create two files <code>EntityManagementFeatures.hh</code> and <code>EntityManagementFeatures.cc</code> to implement a single feature <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> in <code>EntityManagementFeatures</code> "FeatureList" using TPE API from <code>tpe/lib</code> in Ignition Physics library.</p>
<p>Before we dive into the feature implementation, we need to understand how the features are defined.</p>
<p>The <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> is declared in a function template file <code>ign-physics/include/ignition/physics/ConstructEmpty.hh</code>.</p>
<p>Ignition Physics library uses function templates to specify features that accept generic types. The use of templates makes it easier to implement features using different physics engine APIs, without having to repeat the entire code for a function.</p>
<p>The <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> example here is implemented with TPE API, but a similar feature can also be implemented using DART API.</p>
<p>In this case, we are implementing a feature that is already defined by Ignition Physics, thus we do not need to write our own template function, and can just include the template in our header file.</p>
<p>But first, let's include the basics:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2Implements_8hh.html">gz/physics/Implements.hh</a>&gt;</span></div>
</div><!-- fragment --><p> Then, we include the specific feature template file and add it to the feature list:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2ConstructEmpty_8hh.html">gz/physics/ConstructEmpty.hh</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceignition.html">ignition</a> {</div>
<div class="line"><span class="keyword">namespace </span>physics {</div>
<div class="line"><span class="keyword">namespace </span>simpleplugin {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>EntityManagementFeatureList : FeatureList&lt;</div>
<div class="line">  ConstructEmptyWorldFeature</div>
<div class="line">&gt; { };</div>
<div class="line"> </div>
</div><!-- fragment --><p> We also need to declare the feature function in the header file, but since the function is already declared in the template file we just included, we need to override the generic declaration instead:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>EntityManagementFeatures :</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a>&lt;EntityManagementFeatureList&gt;</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>: Identity ConstructEmptyWorld(</div>
<div class="line">    <span class="keyword">const</span> Identity &amp;_engineID, <span class="keyword">const</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> &amp;_name) <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p> The <code>EntityManagementFeatures</code> "FeatureList" here inherits from:</p><ul>
<li>(optionally) Base class for foundation metadata definitions of Models, Joints, Links, and Shapes objects of TPE to provide easy access to <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe/lib">tpelib</a> structures in the TPE library.</li>
<li><a class="el" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a> for implementing the custom feature with <a class="el" href="namespaceignition_1_1physics.html#a7f245b484b6675dbb78f5b1aa68790b2">FeaturePolicy3d</a> ("FeaturePolicy" of 3 dimensions and scalar type <code>double</code>).</li>
</ul>
<p>Then we can go ahead with the implementation of <code>ConstructEmptyWorldFeature</code>:</p>
<div class="fragment"></div><!-- fragment --><p> Here we show the overriding of <code>ConstructEmptyWorld</code> member function of <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a>, this is where we use the physics engine API to implement this member function. We simply instantiate World object, set the world name and call AddWorld function which was defined in <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/Base.hh">Base.hh</a>.</p>
<p>Simple unit tests are good practice for sanity checks. While we won't go into detail, here is an example to test our new <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a>:</p>
<div class="fragment"></div><!-- fragment --><p> To get a more comprehensive view of how <code>EntityManagementFeatures</code> are constructed in TPE and Dartsim, feel free to take a look here:</p><ul>
<li>Dartsim: <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/dartsim/src/EntityManagementFeatures.hh">EntityManagementFeatures.hh</a> and <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/dartsim/src/EntityManagementFeatures.cc">EntityManagementFeatures.cc</a></li>
<li>TPE: <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/tpe/plugin/src/EntityManagementFeatures.hh">EntityManagementFeatures.hh</a> and <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/tpe/plugin/src/EntityManagementFeatures.cc">EntityManagementFeatures.cc</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md79"></a>
Load and test</h2>
<p>Please follow the previous tutorial <a class="el" href="installation.html">Installation</a> to build <code>ign-physics</code> from source again for our new feature to be compiled.</p>
<p>Now we can load the new physics plugin named <code>ignition-physics-tpe-plugin</code> to test it on Ignition Gazebo by following this <a class="el" href="physicsengine.html">Use different physics engines</a> tutorial. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespaceignition_html"><div class="ttname"><a href="namespaceignition.html">ignition</a></div></div>
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div><div class="ttdoc">STL class.</div></div>
<div class="ttc" id="agz_2physics_2Register_8hh_html_a983192a469b717a9c981c80aaa971aae"><div class="ttname"><a href="gz_2physics_2Register_8hh.html#a983192a469b717a9c981c80aaa971aae">IGN_PHYSICS_ADD_PLUGIN</a></div><div class="ttdeci">#define IGN_PHYSICS_ADD_PLUGIN(PluginType, FeaturePolicyT, FeatureListT)</div><div class="ttdoc">Add a plugin that can be used as physics engine.</div><div class="ttdef"><b>Definition:</b> gz/physics/Register.hh:45</div></div>
<div class="ttc" id="aignition_2physics_2RemoveEntities_8hh_html"><div class="ttname"><a href="ignition_2physics_2RemoveEntities_8hh.html">RemoveEntities.hh</a></div></div>
<div class="ttc" id="aignition_2physics_2ConstructEmpty_8hh_html"><div class="ttname"><a href="ignition_2physics_2ConstructEmpty_8hh.html">ConstructEmpty.hh</a></div></div>
<div class="ttc" id="astructignition_1_1physics_1_1RequestEngine_html_aa04799d42bf6171a8e5cb7e83c631aaa"><div class="ttname"><a href="structignition_1_1physics_1_1RequestEngine.html#aa04799d42bf6171a8e5cb7e83c631aaa">ignition::physics::RequestEngine::From</a></div><div class="ttdeci">static EnginePtrType From(const PtrT &amp;_pimpl, const std::size_t _engineID=0)</div><div class="ttdoc">Get an Engine from the given physics plugin.</div></div>
<div class="ttc" id="aignition_2physics_2GetEntities_8hh_html"><div class="ttname"><a href="ignition_2physics_2GetEntities_8hh.html">GetEntities.hh</a></div></div>
<div class="ttc" id="agz_2physics_2Implements_8hh_html"><div class="ttname"><a href="gz_2physics_2Implements_8hh.html">Implements.hh</a></div></div>
<div class="ttc" id="astructignition_1_1physics_1_1FeatureList_html"><div class="ttname"><a href="structignition_1_1physics_1_1FeatureList.html">ignition::physics::FeatureList</a></div><div class="ttdoc">Use a FeatureList to aggregate a list of Features.</div><div class="ttdef"><b>Definition:</b> gz/physics/FeatureList.hh:51</div></div>
<div class="ttc" id="aclassignition_1_1plugin_1_1Loader_html_a78b2ddd492810b5120ad19bc708aa137"><div class="ttname"><a href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1Loader.html#a78b2ddd492810b5120ad19bc708aa137">ignition::plugin::Loader::LoadLib</a></div><div class="ttdeci">std::unordered_set&lt; std::string &gt; LoadLib(const std::string &amp;_pathToLibrary)</div></div>
<div class="ttc" id="anamespaceignition_1_1physics_html_a6d38e59cc9ee7d1edeb9af2205aac83d"><div class="ttname"><a href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">ignition::physics::Implements3d</a></div><div class="ttdeci">Implements&lt; FeaturePolicy3d, FeatureListT &gt; Implements3d</div><div class="ttdef"><b>Definition:</b> gz/physics/Implements.hh:38</div></div>
<div class="ttc" id="aclassignition_1_1plugin_1_1Loader_html"><div class="ttname"><a href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1Loader.html">ignition::plugin::Loader</a></div></div>
<div class="ttc" id="aignition_2physics_2Register_8hh_html"><div class="ttname"><a href="ignition_2physics_2Register_8hh.html">Register.hh</a></div></div>
<div class="ttc" id="aignition_2physics_2RequestEngine_8hh_html"><div class="ttname"><a href="ignition_2physics_2RequestEngine_8hh.html">RequestEngine.hh</a></div></div>
<div class="ttc" id="aignition_2physics_2Implements_8hh_html"><div class="ttname"><a href="ignition_2physics_2Implements_8hh.html">Implements.hh</a></div></div>
<div class="ttc" id="aclassignition_1_1plugin_1_1TemplatePluginPtr_html"><div class="ttname"><a href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1TemplatePluginPtr.html">ignition::plugin::TemplatePluginPtr</a></div></div>
<div class="ttc" id="aignition_2physics_2Shape_8hh_html"><div class="ttname"><a href="ignition_2physics_2Shape_8hh.html">Shape.hh</a></div></div>
<div class="ttc" id="agz_2physics_2ConstructEmpty_8hh_html"><div class="ttname"><a href="gz_2physics_2ConstructEmpty_8hh.html">ConstructEmpty.hh</a></div></div>
<div class="ttc" id="aclassignition_1_1plugin_1_1Loader_html_a38af38708f58ad09a98603ed08fdb33c"><div class="ttname"><a href="https://gazebosim.org/api/plugin/1/classignition_1_1plugin_1_1Loader.html#a38af38708f58ad09a98603ed08fdb33c">ignition::plugin::Loader::Instantiate</a></div><div class="ttdeci">PluginPtr Instantiate(const std::string &amp;_pluginNameOrAlias) const</div></div>
<div class="ttc" id="anamespaceignition_1_1physics_html_a7f245b484b6675dbb78f5b1aa68790b2"><div class="ttname"><a href="namespaceignition_1_1physics.html#a7f245b484b6675dbb78f5b1aa68790b2">ignition::physics::FeaturePolicy3d</a></div><div class="ttdeci">FeaturePolicy&lt; double, 3 &gt; FeaturePolicy3d</div><div class="ttdef"><b>Definition:</b> gz/physics/FeaturePolicy.hh:68</div></div>
      </div>
    </main>
  </div>
</body>
