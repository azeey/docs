<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Physics">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Physics: Use a custom engine with Ignition Physics</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Physics</h1>
        <h2>API Reference</h2>
        <div class="version">
        2.6.2
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 IgnCreateDocs.cmake -->
      <nav class="ign-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Use a custom engine with Ignition Physics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md59"></a>
Prerequisites</h2>
<ul>
<li><a class="el" href="installation.html">Installation</a></li>
<li><a class="el" href="physicsplugin.html">Understand physics plugin</a></li>
<li><a class="el" href="physicsengine.html">Use different physics engines</a></li>
<li>Load physics plugin</li>
<li>Implement custom feature</li>
</ul>
<h2><a class="anchor" id="autotoc_md60"></a>
How to interface with physics engine</h2>
<p>In the previous Implement custom feature tutorial, we walked through how to define and implement a custom feature using an already supported physics engine. This tutorial will explain step-by-step how to interface with any physics engine using Ignition Physics. We will use <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> as an example in this tutorial.</p>
<h3><a class="anchor" id="autotoc_md61"></a>
Structure of a physics plugin</h3>
<p>Depending on what physics engine you would like to use, the folder structure could be slightly different from what's shown below. Here's the plugin folder structure of TPE, within the Ignition Physics library.</p>
<div class="fragment"><div class="line">ign-physics</div>
<div class="line">├── tpe</div>
<div class="line">│   ├── plugin                           Implementation of the plugin features interfacing the physics engines API</div>
<div class="line">│   │    ├── src</div>
<div class="line">│   │    |     ├── plugin.cc             Main file for the plugin declaration and plugin registering.</div>
<div class="line">│   │    |     ├── &lt;FEATURES&gt;.hh         The FeatureList header file.</div>
<div class="line">│   │    |     ├── &lt;FEATURES&gt;.cc         Implementation of the FeatureList using physics engine API</div>
<div class="line">│   │    |     └── &lt;FEATURES_TEST&gt;.cc    Tests</div>
<div class="line">│   │    └── CMakeLists.txt              CMake build script for the plugin features.</div>
<div class="line">│   └── CMakeLists.txt                   CMake build script for the plugin.</div>
<div class="line">└── CMakeList.txt                        CMake build script for Ignition Physics library.</div>
</div><!-- fragment --><p>We link the external physics engine library in <code>CMakeLists.txt</code> of the plugin, assuming the physics engine library is already installed. In our case, <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> is placed inside Ignition Physics and hence there is a <code>lib</code> folder under <code>tpe</code>.</p>
<p>We declare and implement the <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> interfacing with the physics engine API inside <code>plugin/src</code> folder (please see Implement custom feature for the plugin feature requirements). Depending on design target, a <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> is generally a packing of related <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a>. For example in TPE's <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/EntityManagementFeatures.hh">EntityManagementFeatures</a> , there are <a class="el" href="classignition_1_1physics_1_1GetEngineInfo.html">GetEngineInfo</a>, <a class="el" href="classignition_1_1physics_1_1GetWorldFromEngine.html">GetWorldFromEngine</a>, etc. features defined in the "FeatureList" structure for entity management purpose.</p>
<p>Conventionally, a <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> can be implemented as:</p><ul>
<li><code>&lt;FEATURES&gt;.hh</code> for the "FeatureList" declaration.</li>
<li><code>&lt;FEATURES&gt;.cc</code> for the "FeatureList" implementation corresponding to each of the <a class="el" href="classignition_1_1physics_1_1Feature.html">Features</a> member functions, using the physics engine API to realize the feature behavior. For a list of common pre-defined features in Ignition Physics, please refer to <a class="el" href="physicsplugin.html">Understand physics plugin</a> tutorial.</li>
<li><code>&lt;FEATURES_TEST&gt;.cc</code> for unit tests of the "FeatureList".</li>
</ul>
<p>Next, we will use a simplified TPE plugin example to explain important components needed to interface with any physics engine. All code examples used below can be downloaded from <a href="https://github.com/ignitionrobotics/ign-physics/tree/ign-physics2/examples">examples</a> under the <code>simple_plugin</code> folder:</p>
<div class="fragment"><div class="line">simple_plugin</div>
<div class="line">├── CMakeLists.txt</div>
<div class="line">├── plugin.cc</div>
<div class="line">├── EntityManagementFeatures.hh</div>
<div class="line">├── EntityManagementFeatures.cc</div>
<div class="line">└── EntityManagementFeatures_TEST.cc</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md62"></a>
&lt;tt&gt;plugin.cc&lt;/tt&gt;</h3>
<p>In this tutorial, we will show how to construct a simple simulation world using <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe">TPE</a> physics engine. For this purpose, we will implement the pre-defined <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> and include this feature into an empty <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> named <code>EntityManagementFeatureList</code> defined in <code>EntityManagementFeatures.hh</code>. We first include the <code>EntityManagementFeatureList</code> in <code>plugin.cc</code> main file and register the example TPE physics plugin as follow:</p>
<div class="fragment"></div><!-- fragment --><p> Those are 3 things needed to be specified in <code>plugin.cc</code>:</p><ul>
<li>Define the conclusive <a class="el" href="structignition_1_1physics_1_1FeatureList.html">FeatureList</a> including all required "FeatureLists" and <code>Base</code> class. In TPE case, it is <code>TpePluginFeatures</code>.</li>
<li>Define the dimension of the simulation, ex. <a class="el" href="namespaceignition_1_1physics.html#a2d96f4e9c1426d8a61da147434b61d66">Implements</a> class implementing <a class="el" href="structignition_1_1physics_1_1FeaturePolicy.html">FeaturePolicy</a> 2D or 3D and different scalar type.</li>
<li>Register the physics plugin using <code>IGN_PHYSICS_ADD_PLUGIN</code> macro (See Implement physics plugin for more detail).</li>
</ul>
<h3><a class="anchor" id="autotoc_md63"></a>
Implement features with physics engine's API</h3>
<p>Now we would like to implement the <code>EntityManagementFeatures</code>. In the <code>simple_plugin</code> folder, we will create two files <code>EntityManagementFeatures.hh</code> and <code>EntityManagementFeatures.cc</code> to implement a single feature <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> in <code>EntityManagementFeatures</code> "FeatureList" using TPE API from <code>tpe/lib</code> in Ignition Physics library.</p>
<p>Before we dive into the feature implementation, we need to understand how the features are defined.</p>
<p>The <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> is declared in a function template file <code>ign-physics/include/ignition/physics/ConstructEmpty.hh</code>.</p>
<p>Ignition Physics library uses function templates to specify features that accept generic types. The use of templates makes it easier to implement features using different physics engine APIs, without having to repeat the entire code for a function.</p>
<p>The <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a> example here is implemented with TPE API, but a similar feature can also be implemented using DART API.</p>
<p>In this case, we are implementing a feature that is already defined by Ignition Physics, thus we do not need to write our own template function, and can just include the template in our header file.</p>
<p>But first, let's include the basics:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2Implements_8hh.html">gz/physics/Implements.hh</a>&gt;</span></div>
</div><!-- fragment --><p> Then, we include the specific feature template file and add it to the feature list:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gz_2physics_2ConstructEmpty_8hh.html">gz/physics/ConstructEmpty.hh</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceignition.html">ignition</a> {</div>
<div class="line"><span class="keyword">namespace </span>physics {</div>
<div class="line"><span class="keyword">namespace </span>simpleplugin {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>EntityManagementFeatureList : FeatureList&lt;</div>
<div class="line">  ConstructEmptyWorldFeature</div>
<div class="line">&gt; { };</div>
<div class="line"> </div>
</div><!-- fragment --><p> We also need to declare the feature function in the header file, but since the function is already declared in the template file we just included, we need to override the generic declaration instead:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>EntityManagementFeatures :</div>
<div class="line">  <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a>&lt;EntityManagementFeatureList&gt;</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>: Identity ConstructEmptyWorld(</div>
<div class="line">    <span class="keyword">const</span> Identity &amp;_engineID, <span class="keyword">const</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> &amp;_name) <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p> The <code>EntityManagementFeatures</code> "FeatureList" here inherits from:</p><ul>
<li>(optionally) Base class for foundation metadata definitions of Models, Joints, Links, and Shapes objects of TPE to provide easy access to <a href="https://github.com/ignitionrobotics/ign-physics/tree/main/tpe/lib">tpelib</a> structures in the TPE library.</li>
<li><a class="el" href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">Implements3d</a> for implementing the custom feature with <a class="el" href="namespaceignition_1_1physics.html#a7f245b484b6675dbb78f5b1aa68790b2">FeaturePolicy3d</a> ("FeaturePolicy" of 3 dimensions and scalar type <code>double</code>).</li>
</ul>
<p>Then we can go ahead with the implementation of <code>ConstructEmptyWorldFeature</code>:</p>
<div class="fragment"></div><!-- fragment --><p> Here we show the overriding of <code>ConstructEmptyWorld</code> member function of <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a>, this is where we use the physics engine API to implement this member function. We simply instantiate World object, set the world name and call AddWorld function which was defined in <a href="https://github.com/ignitionrobotics/ign-physics/blob/main/tpe/plugin/src/Base.hh">Base.hh</a>.</p>
<p>Simple unit tests are good practice for sanity checks. While we won't go into detail, here is an example to test our new <a class="el" href="classignition_1_1physics_1_1ConstructEmptyWorldFeature.html">ConstructEmptyWorldFeature</a>:</p>
<div class="fragment"></div><!-- fragment --><p> To get a more comprehensive view of how <code>EntityManagementFeatures</code> are constructed in TPE and Dartsim, feel free to take a look here:</p><ul>
<li>Dartsim: <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/dartsim/src/EntityManagementFeatures.hh">EntityManagementFeatures.hh</a> and <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/dartsim/src/EntityManagementFeatures.cc">EntityManagementFeatures.cc</a></li>
<li>TPE: <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/tpe/plugin/src/EntityManagementFeatures.hh">EntityManagementFeatures.hh</a> and <a href="https://github.com/ignitionrobotics/ign-physics/blob/ign-physics2/tpe/plugin/src/EntityManagementFeatures.cc">EntityManagementFeatures.cc</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md64"></a>
Load and test</h2>
<p>Please follow the previous tutorial <a class="el" href="installation.html">Installation</a> to build <code>ign-physics</code> from source again for our new feature to be compiled.</p>
<p>Now we can load the new physics plugin named <code>ignition-physics-tpe-plugin</code> to test it on Ignition Gazebo by following this <a class="el" href="physicsengine.html">Use different physics engines</a> tutorial. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespaceignition_html"><div class="ttname"><a href="namespaceignition.html">ignition</a></div></div>
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div><div class="ttdoc">STL class.</div></div>
<div class="ttc" id="agz_2physics_2Implements_8hh_html"><div class="ttname"><a href="gz_2physics_2Implements_8hh.html">Implements.hh</a></div></div>
<div class="ttc" id="anamespaceignition_1_1physics_html_a6d38e59cc9ee7d1edeb9af2205aac83d"><div class="ttname"><a href="namespaceignition_1_1physics.html#a6d38e59cc9ee7d1edeb9af2205aac83d">ignition::physics::Implements3d</a></div><div class="ttdeci">Implements&lt; FeaturePolicy3d, FeatureListT &gt; Implements3d</div><div class="ttdef"><b>Definition:</b> gz/physics/Implements.hh:38</div></div>
<div class="ttc" id="agz_2physics_2ConstructEmpty_8hh_html"><div class="ttname"><a href="gz_2physics_2ConstructEmpty_8hh.html">ConstructEmpty.hh</a></div></div>
      </div>
    </main>
  </div>
</body>
