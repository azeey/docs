<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Sim">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Sim: Underwater vehicles</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Sim</h1>
        <h2>API Reference</h2>
        <div class="version">
        7.8.0
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 GzCreateDocs.cmake -->
      <nav class="gz-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Underwater vehicles </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md338"></a>
Simulating Autnomous Underwater Vehicles</h2>
<p>Gazebo now supports basic simulation of underwater vehicles. This capability is based on the equations described in Fossen's <a href="https://www.wiley.com/en-sg/Guidance+and+Control+of+Ocean+Vehicles-p-9780471941132">"Guidance and Control of Ocean Vehicles"</a>. This tutorial will guide you through the steps you need to setup simulation of an underwater vehicle. In this tutorial, we will guide you through the setup of the <a href="https://app.gazebosim.org/accurrent/fuel/models/MBARI%20Tethys%20LRAUV">MBARI Tethys</a>. One can find the final sdf file for this tutorial in the <code>examples/worlds/auv_controls.sdf</code> file.</p>
<h2><a class="anchor" id="autotoc_md339"></a>
Understanding Hydrodynamic Forces</h2>
<p>The behaviour of a moving body through water is different from the behaviour of a ground based vehicle. In particular bodies moving underwater experience much more forces derived from drag, buoyancy and lift. The way these forces act on a body can be seen in the following diagram: <img src="https://raw.githubusercontent.com/gazebosim/gz-sim/ign-gazebo5/tutorials/files/underwater/MBARI%20forces.png" alt="force diagram" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md340"></a>
Setting up the buoyancy plugin</h2>
<p>The buoyancy plugin in Gazebo uses the collision mesh to calculate the volume of the vehicle. The calculated volume is used to determine the buoyancy force, which is then applied at the pose of the collision mesh in the link frame. Note that this may be a different location from the center of volume.</p>
<p>Additionally, it needs to know the density of the fluid in which it is moving. By default this is set to 1000kgm^-3. However, in real life this may vary depending on many factors like depth, salinity of water etc. To add the buoyancy plugin all one needs to do is add the following under the <code>&lt;world&gt;</code> tag: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">      <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-buoyancy-system&quot;</span></div>
<div class="line">      <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Buoyancy&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">uniform_fluid_density</span>&gt;1000&lt;/<span class="keywordtype">uniform_fluid_density</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md341"></a>
Setting up the thrusters</h2>
<p>We need the vehicle to move, so we will be adding the <code>Thruster</code> plugin. The thruster plugin takes in a force and applies it along with calculating the desired rpm. Under the <code>&lt;include&gt;</code> or <code>&lt;model&gt;</code> tag add the following: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line">    <span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-thruster-system&quot;</span></div>
<div class="line">    <span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Thruster&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">namespace</span>&gt;<span class="keyword">tethys</span>&lt;/<span class="keywordtype">namespace</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">propeller_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">thrust_coefficient</span>&gt;0.004422&lt;/<span class="keywordtype">thrust_coefficient</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">fluid_density</span>&gt;1000&lt;/<span class="keywordtype">fluid_density</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">propeller_diameter</span>&gt;0.2&lt;/<span class="keywordtype">propeller_diameter</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>Now if we were to publish to <code>/model/tethys/joint/propeller_joint/cmd_thrust</code> </p><div class="fragment"><div class="line">gz topic -t /model/tethys/joint/propeller_joint/cmd_thrust \</div>
<div class="line">   -m gz.msgs.Double -p &#39;data: -31&#39;</div>
</div><!-- fragment --><p>we should see the model move. The thrusters are governed by the equation on page 246 of Fossen's book. In particular it relates force to rpm as follows: <code>Thrust = fluid_density * RPM^2 * thrust_constant * propeller blade size^4</code>. The plugin takes in commands in newtons. So if you have a different thrust curve you can still use the plugin with some type of adapter script. The thrust constant is normally determined by individual manufacturers. In this case we are using the Tethys's thrust coefficient. you may also build a test rig to measure your thruster's thrust coefficient.</p>
<h2><a class="anchor" id="autotoc_md342"></a>
Adding Hydrodynamic behaviour</h2>
<p>You may notice that the robot now keeps getting faster and faster. This is because there is no drag to oppose the thruster's force. We will be using Fossen's equations which describe the motion of a craft through the water for this. For better understanding of the parameters here, I would refer you to his book. Usually these parameters can be found via fluid simulation programs or experimental tests in a water tub. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-hydrodynamics-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::Hydrodynamics&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">base_link</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xDotU</span>&gt;-4.876161&lt;/<span class="keywordtype">xDotU</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">yDotV</span>&gt;-126.324739&lt;/<span class="keywordtype">yDotV</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">zDotW</span>&gt;-126.324739&lt;/<span class="keywordtype">zDotW</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">kDotP</span>&gt;0&lt;/<span class="keywordtype">kDotP</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">mDotQ</span>&gt;-33.46&lt;/<span class="keywordtype">mDotQ</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">nDotR</span>&gt;-33.46&lt;/<span class="keywordtype">nDotR</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xUabsU</span>&gt;-6.2282&lt;/<span class="keywordtype">xUabsU</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xU</span>&gt;0&lt;/<span class="keywordtype">xU</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">yVabsV</span>&gt;-601.27&lt;/<span class="keywordtype">yVabsV</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">yV</span>&gt;0&lt;/<span class="keywordtype">yV</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">zWabsW</span>&gt;-601.27&lt;/<span class="keywordtype">zWabsW</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">zW</span>&gt;0&lt;/<span class="keywordtype">zW</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">kPabsP</span>&gt;-0.1916&lt;/<span class="keywordtype">kPabsP</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">kP</span>&gt;0&lt;/<span class="keywordtype">kP</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">mQabsQ</span>&gt;-632.698957&lt;/<span class="keywordtype">mQabsQ</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">mQ</span>&gt;0&lt;/<span class="keywordtype">mQ</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">nRabsR</span>&gt;-632.698957&lt;/<span class="keywordtype">nRabsR</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">nR</span>&gt;0&lt;/<span class="keywordtype">nR</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md343"></a>
Control surfaces</h2>
<p>Just like aeroplanes, an underwater vehicle may also use fins for stability and control. Fortunately, Gazebo already has a version of the LiftDrag plugin. In this tutorial, we will simply add two liftdrag plugins to the rudder and elevator of MBARI's Tethys. For more info about the liftdrag plugin inluding what the parameters mean you may look at <a href="http://gazebosim.org/tutorials?tut=aerodynamics&amp;cat=physics">this gazebo classic tutorial</a>. Essentially when we tilt the fins, we should experience a lift force which will cause the vehicle to experience a torque and the vehicle should start turning when we move.</p>
<div class="fragment"><div class="line"><span class="comment">&lt;!-- Vertical fin --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-lift-drag-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::LiftDrag&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">air_density</span>&gt;1000&lt;/<span class="keywordtype">air_density</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cla</span>&gt;4.13&lt;/<span class="keywordtype">cla</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cla_stall</span>&gt;-1.1&lt;/<span class="keywordtype">cla_stall</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cda</span>&gt;0.2&lt;/<span class="keywordtype">cda</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cda_stall</span>&gt;0.03&lt;/<span class="keywordtype">cda_stall</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">alpha_stall</span>&gt;0.17&lt;/<span class="keywordtype">alpha_stall</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">a0</span>&gt;0&lt;/<span class="keywordtype">a0</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">area</span>&gt;0.0244&lt;/<span class="keywordtype">area</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">upward</span>&gt;0 1 0&lt;/<span class="keywordtype">upward</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">forward</span>&gt;1 0 0&lt;/<span class="keywordtype">forward</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">vertical_fins</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cp</span>&gt;0 0 0&lt;/<span class="keywordtype">cp</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line"><span class="comment">&lt;!-- Horizontal fin --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-lift-drag-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::LiftDrag&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">air_density</span>&gt;1000&lt;/<span class="keywordtype">air_density</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cla</span>&gt;4.13&lt;/<span class="keywordtype">cla</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cla_stall</span>&gt;-1.1&lt;/<span class="keywordtype">cla_stall</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cda</span>&gt;0.2&lt;/<span class="keywordtype">cda</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cda_stall</span>&gt;0.03&lt;/<span class="keywordtype">cda_stall</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">alpha_stall</span>&gt;0.17&lt;/<span class="keywordtype">alpha_stall</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">a0</span>&gt;0&lt;/<span class="keywordtype">a0</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">area</span>&gt;0.0244&lt;/<span class="keywordtype">area</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">upward</span>&gt;0 0 1&lt;/<span class="keywordtype">upward</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">forward</span>&gt;1 0 0&lt;/<span class="keywordtype">forward</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">link_name</span>&gt;<span class="keyword">horizontal_fins</span>&lt;/<span class="keywordtype">link_name</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">cp</span>&gt;0 0 0&lt;/<span class="keywordtype">cp</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>The number in this case were kindly provided by MBARI for the Tethys. We also need to be able to control the position of the thruster fins so we will use the joint controller plugin. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-joint-position-controller-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::JointPositionController&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">horizontal_fins_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">p_gain</span>&gt;0.1&lt;/<span class="keywordtype">p_gain</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">plugin</span></div>
<div class="line"><span class="keyword">filename</span>=<span class="stringliteral">&quot;gz-sim-joint-position-controller-system&quot;</span></div>
<div class="line"><span class="keyword">name</span>=<span class="stringliteral">&quot;gz::sim::systems::JointPositionController&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">joint_name</span>&gt;<span class="keyword">vertical_fins_joint</span>&lt;/<span class="keywordtype">joint_name</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">p_gain</span>&gt;0.1&lt;/<span class="keywordtype">p_gain</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p>We should now be able to wiggle the fins using the following command: </p><div class="fragment"><div class="line">gz topic -t /model/tethys/joint/vertical_fins_joint/0/cmd_pos \</div>
<div class="line">  -m gz.msgs.Double -p &#39;data: -0.17&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md344"></a>
Testing the system out</h2>
<p>To control the rudder of the craft run the following </p><div class="fragment"><div class="line">gz topic -t /model/tethys/joint/vertical_fins_joint/0/cmd_pos \</div>
<div class="line">   -m gz.msgs.Double -p &#39;data: -0.17&#39;</div>
</div><!-- fragment --><p>To apply a thrust you may run the following command </p><div class="fragment"><div class="line">gz topic -t /model/tethys/joint/propeller_joint/cmd_thrust \</div>
<div class="line">-m gz.msgs.Double -p &#39;data: -31&#39;</div>
</div><!-- fragment --><p>The vehicle should move in a circle.</p>
<h2><a class="anchor" id="autotoc_md345"></a>
Ocean Currents</h2>
<p>When underwater, vehicles are often subject to ocean currents. The hydrodynamics plugin allows simulation of such currents. We can add a current simply by publishing the following: </p><div class="fragment"><div class="line">gz topic -t /ocean_current -m gz.msgs.Vector3d -p &#39;x: 1, y:0, z:0&#39;</div>
</div><!-- fragment --><p>You should observe your vehicle slowly drift to the side. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
      </div>
    </main>
  </div>
</body>
