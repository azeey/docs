<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="keywords" content="Gazebo Transport">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gazebo Transport: Messages</title>
    <script type="text/javascript" src="https://gazebosim.org/assets/doxygen/dynsections.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
    <link rel="icon" type="image/x-icon" href="https://gazebosim.org/assets/icon/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.deep_orange-blue.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"> </script>
    <link href="https://gazebosim.org/assets/doxygen/doxygen.css" rel="stylesheet" type="text/css">
  </head>
    <script type="text/javascript">
      /* Replace all the "permalink" &#9670;&nbsp; icons with a unicode link
        symbol.*/
      $(document).ready(function() {
        var elems = document.getElementsByClassName("permalink");
        for (var i = 0; i < elems.length; ++i) {
          elems[i].firstChild.innerHTML="&#x1f517;";
          elems[i].firstChild.style.fontSize="18px";
        }
      });
    </script>
  </head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer">
    <div class="mdl-layout__drawer mdl-color--grey-100 mdl-color-text--blue-grey-50">
      <header class="mdl-color--grey-100">
        <a href="index.html"><img width="60px" src="https://gazebosim.org/assets/doxygen/gazebo_logo.svg"/></a>
        <h1 class="project_title">Gazebo Transport</h1>
        <h2>API Reference</h2>
        <div class="version">
        11.4.1
        </div>
      </header>
      <!-- NOTE: If you add a link to a doxygen generated page, then make
                 sure to update the required_html_fils list in
                 IgnCreateDocs.cmake -->
      <nav class="ign-navigation mdl-navigation">
        <a class="mdl-navigation__link" href="tutorials.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Tutorials</a>
        <a id="class_menu" class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">library_books</i>Classes</a>
        <a id="namespaces_menu"class="mdl-navigation__link" href="#">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">toc</i>Namespaces</a>
        <a class="mdl-navigation__link" href="files.html">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">insert_drive_file</i>Files</a>
        <a class="mdl-navigation__link" target="_blank"
           href="http://gazebosim.org">
          <i class="mdl-color-text--grey-400 material-icons"
             role="presentation">launch</i>Gazebo Website</a>
      </nav>
      <!-- classes sub menu -->
      <ul for="class_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link" href="classes.html">Index</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="annotated.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="hierarchy.html">Hierarchy</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions.html">Members: All</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_func.html">Members: Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_vars.html">Members: Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_type.html">Members: Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_enum.html">Members: Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
             href="functions_eval.html">Members: Enumerator</a>
        </li>
      </ul>
      <!-- namespaces sub menu -->
      <ul for="namespaces_menu" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect mdl-navigation">
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespaces.html">List</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers.html">Members</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_func.html">Functions</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_type.html">Typedefs</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_vars.html">Variables</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_enum.html">Enumerations</a>
        </li>
        <li class="mdl-menu__item">
          <a class="mdl-navigation__link"
            href="namespacemembers_eval.html">Enumerator</a>
        </li>
      </ul>
    </div>
    <main class="mdl-layout__content mdl-color--white">
    <div id="top">
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Messages </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Next Tutorial: <a class="el" href="services.html">Services</a> Previous Tutorial: <a class="el" href="nodestopics.html">Nodes and Topics</a></p>
<h2><a class="anchor" id="autotoc_md23"></a>
Overview</h2>
<p>In this tutorial, we are going to create two nodes that are going to communicate via messages. One node will be a publisher that generates the information, whereas the other node will be the subscriber consuming the information. Our nodes will be running on different processes within the same machine.</p>
<div class="fragment"><div class="line">mkdir ~/ign_transport_tutorial</div>
<div class="line">cd ~/ign_transport_tutorial</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Publisher</h2>
<p>Download the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/publisher.cc">publisher.cc</a> file within the <code>ign_transport_tutorial</code> folder and open it with your favorite editor:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;csignal&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ignition/msgs.hh&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gz/transport.hh&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/atomic/atomic.html">std::atomic&lt;bool&gt;</a> g_terminatePub(<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> signal_handler(<span class="keywordtype">int</span> _signal)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (_signal == SIGINT || _signal == SIGTERM)</div>
<div class="line">    g_terminatePub = <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Install a signal handler for SIGINT and SIGTERM.</span></div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/utility/program/signal.html">std::signal</a>(SIGINT,  signal_handler);</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/utility/program/signal.html">std::signal</a>(SIGTERM, signal_handler);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a transport node and advertise a topic.</span></div>
<div class="line">  gz::transport::Node node;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> pub = node.Advertise&lt;gz::msgs::StringMsg&gt;(topic);</div>
<div class="line">  <span class="keywordflow">if</span> (!pub)</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error advertising topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Prepare the message.</span></div>
<div class="line">  gz::msgs::StringMsg msg;</div>
<div class="line">  msg.set_data(<span class="stringliteral">&quot;HELLO&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Publish messages at 1Hz.</span></div>
<div class="line">  <span class="keywordflow">while</span> (!g_terminatePub)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (!pub.Publish(msg))</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Publishing hello on topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/thread/sleep_for.html">std::this_thread::sleep_for</a>(<a class="codeRef" href="http://en.cppreference.com/w/cpp/chrono/duration.html">std::chrono::milliseconds</a>(1000));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md25"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;ignition/msgs.hh&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gz/transport.hh&gt;</span></div>
</div><!-- fragment --><p>The line <code>#include &lt;gz/transport.hh&gt;</code> contains all the Ignition Transport headers for using the transport library.</p>
<p>The next line includes the generated protobuf code that we are going to use for our messages. We are going to publish <code>StringMsg</code> type protobuf messages.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a transport node and advertise a topic.</span></div>
<div class="line">gz::transport::Node node;</div>
<div class="line"><a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> pub = node.Advertise&lt;gz::msgs::StringMsg&gt;(topic);</div>
<div class="line"><span class="keywordflow">if</span> (!pub)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error advertising topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><p>First of all we declare a <em>Node</em> that will offer some of the transport functionality. In our case, we are interested in publishing topic updates, so the first step is to announce our topic name and its type. Once a topic name is advertised, we can start publishing periodic messages using the publisher object.</p>
<div class="fragment"><div class="line"><span class="comment">// Prepare the message.</span></div>
<div class="line">gz::msgs::StringMsg msg;</div>
<div class="line">msg.set_data(<span class="stringliteral">&quot;HELLO&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Publish messages at 1Hz.</span></div>
<div class="line"><span class="keywordflow">while</span> (!g_terminatePub)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (!pub.Publish(msg))</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Publishing hello on topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/thread/sleep_for.html">std::this_thread::sleep_for</a>(<a class="codeRef" href="http://en.cppreference.com/w/cpp/chrono/duration.html">std::chrono::milliseconds</a>(1000));</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this section of the code we create a protobuf message and fill it with content. Next, we iterate in a loop that publishes one message every second. The method <em>Publish()</em> sends a message to all the subscribers.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Subscriber</h2>
<p>Download the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/subscriber.cc">subscriber.cc</a> file into the <code>ign_transport_tutorial</code> folder and open it with your favorite editor:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ignition/msgs.hh&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gz/transport.hh&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> cb(<span class="keyword">const</span> gz::msgs::StringMsg &amp;_msg)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Msg: &quot;</span> &lt;&lt; _msg.data() &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  gz::transport::Node node;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line">  <span class="comment">// Subscribe to a topic by registering a callback.</span></div>
<div class="line">  <span class="keywordflow">if</span> (!node.Subscribe(topic, cb))</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error subscribing to topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Zzzzzz.</span></div>
<div class="line">  <a class="code" href="namespaceignition_1_1transport.html#af38bca501993d613057e1b45e7c1af68">gz::transport::waitForShutdown</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md27"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> cb(<span class="keyword">const</span> gz::msgs::StringMsg &amp;_msg)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Msg: &quot;</span> &lt;&lt; _msg.data() &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>We need to register a function callback that will execute every time we receive a new topic update. The signature of the callback is always similar to the one shown in this example with the only exception of the protobuf message type. You should create a function callback with the appropriate protobuf type depending on the type of the topic advertised. In our case, we know that topic <code>/foo</code> will contain a Protobuf <code>StringMsg</code> type.</p>
<div class="fragment"><div class="line">gz::transport::Node node;</div>
<div class="line"><a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Subscribe to a topic by registering a callback.</span></div>
<div class="line"><span class="keywordflow">if</span> (!node.Subscribe(topic, cb))</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error subscribing to topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><p>After the node creation, the method <code>Subscribe()</code> allows you to subscribe to a given topic name by specifying your subscription callback function.</p>
<div class="fragment"><div class="line"><span class="comment">// Zzzzzz.</span></div>
<div class="line"><a class="code" href="namespaceignition_1_1transport.html#af38bca501993d613057e1b45e7c1af68">gz::transport::waitForShutdown</a>();</div>
</div><!-- fragment --><p>If you don't have any other tasks to do besides waiting for incoming messages, you can use the call <code><a class="el" href="namespaceignition_1_1transport.html#af38bca501993d613057e1b45e7c1af68" title="Block the current thread until a SIGINT or SIGTERM is received. Note that this function registers a s...">waitForShutdown()</a></code> that will block your current thread until you hit <em>CTRL-C</em>. Note that this function captures the <em>SIGINT</em> and <em>SIGTERM</em> signals.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Building the code</h2>
<p>Download the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/CMakeLists.txt">CMakeLists.txt</a> file within the <code>ign_transport_tutorial</code> folder.</p>
<p>Once you have all your files, go ahead and create a <code>build/</code> directory within the <code>ign_transport_tutorial</code> directory.</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
</div><!-- fragment --><p>Run <code>cmake</code> and build the code.</p>
<div class="fragment"><div class="line">cmake ..</div>
<div class="line">make publisher subscriber</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
Running the examples</h2>
<p>Open two new terminals and from your <code>build/</code> directory run the executables.</p>
<p>From terminal 1:</p>
<div class="fragment"><div class="line">./publisher</div>
</div><!-- fragment --><p>From terminal 2:</p>
<div class="fragment"><div class="line">./subscriber</div>
</div><!-- fragment --><p>In your subscriber terminal, you should expect an output similar to this one, showing that your subscriber is receiving the topic updates:</p>
<div class="fragment"><div class="line">$ ./subscriber</div>
<div class="line">Msg: HELLO</div>
<div class="line"> </div>
<div class="line">Msg: HELLO</div>
<div class="line"> </div>
<div class="line">Msg: HELLO</div>
<div class="line"> </div>
<div class="line">Msg: HELLO</div>
<div class="line"> </div>
<div class="line">Msg: HELLO</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
Advertise Options</h2>
<p>We can specify some options before we publish the messages. One such option is to specify the number of messages published per topic per second. It is optional to use but it can be handy in situations like when we want to control the rate of messages published per topic.</p>
<p>We can declare the throttling option using the following code :</p>
<div class="fragment"><div class="line"><span class="comment">// Create a transport node and advertise a topic with throttling enabled.</span></div>
<div class="line">gz::transport::Node node;</div>
<div class="line"><a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Setting the throttling option</span></div>
<div class="line">gz::transport::AdvertiseMessageOptions opts;</div>
<div class="line">opts.SetMsgsPerSec(1u);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> pub = node.Advertise&lt;gz::msgs::StringMsg&gt;(topic, opts);</div>
<div class="line"><span class="keywordflow">if</span> (!pub)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error advertising topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31"></a>
Walkthrough</h3>
<div class="fragment"><div class="line">gz::transport::AdvertiseMessageOptions opts;</div>
<div class="line">opts.SetMsgsPerSec(1u);</div>
</div><!-- fragment --><p>In this section of code, we declare an <em>AdvertiseMessageOptions</em> object and use it to pass message rate as an argument to <em>SetMsgsPerSec()</em> method. In our case, the object name is opts and the message rate specified is 1 msg/sec.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> pub = node.Advertise&lt;gz::msgs::StringMsg&gt;(topic, opts);</div>
</div><!-- fragment --><p>Next, we advertise the topic with message throttling enabled. To do it, we pass opts as an argument to the <em>Advertise()</em> method.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Subscribe Options</h2>
<p>A similar option is also available for the Subscriber node which enables it to control the rate of incoming messages from a specific topic. While subscribing to a topic, we can use this option to control the number of messages received per second from that particular topic.</p>
<p>We can declare the throttling option using the following code :</p>
<div class="fragment"><div class="line"><span class="comment">// Create a transport node and subscribe to a topic with throttling enabled.</span></div>
<div class="line">gz::transport::Node node;</div>
<div class="line"><a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line">gz::transport::SubscribeOptions opts;</div>
<div class="line">opts.SetMsgsPerSec(1u);</div>
<div class="line">node.Subscribe(topic, cb, opts);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md33"></a>
Walkthrough</h3>
<div class="fragment"><div class="line">gz::transport::SubscribeOptions opts;</div>
<div class="line">opts.SetMsgsPerSec(1u);</div>
<div class="line">node.Subscribe(topic, cb, opts);</div>
</div><!-- fragment --><p>In this section of code, we declare a <em>SubscribeOptions</em> object and use it to pass message rate as an argument to the <em>SetMsgsPerSec()</em> method. In our case, the object name is opts and the message rate specified is 1 msg/sec. Then, we subscribe to the topic using the <em>Subscribe()</em> method with opts passed as an argument to it.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
Generic subscribers</h2>
<p>As you have seen in the examples so far, the callbacks used by the subscribers contain a specific protobuf parameter, such as <code>gz::msgs::StringMsg</code>. As the name of this section suggests, it is also possible to create a generic subscriber callback that can receive messages of different types. This use case might be interesting if you are building a bridge between Ignition Transport and another protocol or if you want to just print the content of a generic protobuf message using <code>DebugString()</code>, among other use cases.</p>
<p>Download the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/subscriber_generic.cc">subscriber_generic.cc</a> file within the <code>ign_transport_tutorial</code> folder and open it with your favorite editor:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;google/protobuf/message.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;gz/transport.hh&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> cb(<span class="keyword">const</span> google::protobuf::Message &amp;_msg,</div>
<div class="line">        <span class="keyword">const</span> gz::transport::MessageInfo &amp;_info)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Topic: [&quot;</span> &lt;&lt; _info.Topic() &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; _msg.DebugString() &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  gz::transport::Node node;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line">  <span class="comment">// Subscribe to a topic by registering a callback.</span></div>
<div class="line">  <span class="keywordflow">if</span> (!node.Subscribe(topic, cb))</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error subscribing to topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Zzzzzz.</span></div>
<div class="line">  <a class="code" href="namespaceignition_1_1transport.html#af38bca501993d613057e1b45e7c1af68">gz::transport::waitForShutdown</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md35"></a>
Walkthrough</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> cb(<span class="keyword">const</span> google::protobuf::Message &amp;_msg,</div>
<div class="line">        <span class="keyword">const</span> gz::transport::MessageInfo &amp;_info)</div>
<div class="line">{</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Topic: [&quot;</span> &lt;&lt; _info.Topic() &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; _msg.DebugString() &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Here, we use the generic callback function signature. Note the use of <code>google::protobuf::Message</code> as the message type in the subscription callback function <code>cb()</code>. It enables us to receive topic updates with different message types, such as <code>Int32</code> or <code>String</code> from the subscribed topic. Furthermore, we don't need to worry about the type of the topic advertised while specifying the callback function. The parameter <code>gz::transport::MessageInfo &amp;_info</code> provides some information about the message received (e.g.: the topic name).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  gz::transport::Node node;</div>
<div class="line">  <a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
<div class="line">  <span class="comment">// Subscribe to a topic by registering a callback.</span></div>
<div class="line">  <span class="keywordflow">if</span> (!node.Subscribe(topic, cb))</div>
<div class="line">  {</div>
<div class="line">    <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a> &lt;&lt; <span class="stringliteral">&quot;Error subscribing to topic [&quot;</span> &lt;&lt; topic &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; <a class="codeRef" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Zzzzzz.</span></div>
<div class="line">  <a class="code" href="namespaceignition_1_1transport.html#af38bca501993d613057e1b45e7c1af68">gz::transport::waitForShutdown</a>();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Similar to the previous examples, we use the <code>Subscribe()</code> function to subscribe to a given topic name by specifying the callback function. In our example, the topic name subscribed is <code>/foo</code>.</p>
<p>Follow the next instructions to compile and run the generic subscriber example:</p>
<p>Run <code>cmake</code> and build the example:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make subscriber_generic</div>
</div><!-- fragment --><p>From terminal 1:</p>
<div class="fragment"><div class="line">./publisher</div>
</div><!-- fragment --><p>From terminal 2:</p>
<div class="fragment"><div class="line">./subscriber_generic</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md36"></a>
Using custom Protobuf messages</h2>
<p>We use Ignition Msgs in most of our examples and tests. This decision was made just for convenience but Ignition Transport supports the use of Protobuf messages directly. The most common problem with custom Protobuf messages is often the integration of the message generation into the build system of your project. Next, you can find an example of a publisher and subscriber using a custom Protobuf message integrated with CMake.</p>
<p>Download the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/publisher_custom_msg.cc">publisher_custom_msg.cc</a> and the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/subscriber_custom_msg.cc">subscriber_custom_msg.cc</a> files within the <code>ign_transport_tutorial</code>. Then, create a <code>msgs</code> folder and download the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/msgs/stringmsg.proto">stringmsg.proto</a> and the <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/msgs/CMakeLists.txt">CMakeLists.txt</a> files within the <code>msgs</code> folder. Finally, we'll need the main <a href="https://github.com/ignitionrobotics/ign-transport/raw/main/example/CMakeLists.txt">CMakeLists.txt</a> file. You should have this file from the previous examples. Otherwise, download and place it within the <code>ign_transport_tutorial</code> folder.</p>
<h3><a class="anchor" id="autotoc_md37"></a>
Walkthrough</h3>
<p>There's nothing new to show in the <code>publisher_custom_msg.cc</code> or <code>subscriber_custom_msg.cc</code> besides the use of your custom Protobuf message instead of Ignition Msgs. The only relevant parts are in the <code>CMakeLists.txt</code> files.</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Message generation. Only required when using custom Protobuf messages.</span></div>
<div class="line">find_package(Protobuf REQUIRED)</div>
<div class="line">add_subdirectory(msgs)</div>
<div class="line">set_source_files_properties(${PROTO_SRC} ${PROTO_HEADER}</div>
<div class="line">                           PROPERTIES GENERATED TRUE)</div>
<div class="line">include_directories(${CMAKE_BINARY_DIR})</div>
</div><!-- fragment --><p>This is how we find the Protobuf CMake config file, to make sure that the macro for Protobuf message generation is available. We also let CMake know that there is a new subdirectory to inspect containing our custom messages.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (EXISTS <span class="stringliteral">&quot;${CMAKE_SOURCE_DIR}/publisher_custom_msg.cc&quot;</span>)</div>
<div class="line">  add_executable(publisher_custom_msg publisher_custom_msg.cc)</div>
<div class="line">  target_link_libraries(publisher_custom_msg</div>
<div class="line">     ${IGNITION-TRANSPORT_LIBRARIES}</div>
<div class="line">     ${PROTO_SRC}</div>
<div class="line">  )</div>
<div class="line">  add_dependencies(publisher_custom_msg protobuf_compilation)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">if (EXISTS &quot;${CMAKE_SOURCE_DIR}/subscriber_custom_msg.cc<span class="stringliteral">&quot;)</span></div>
<div class="line"><span class="stringliteral">  add_executable(subscriber_custom_msg subscriber_custom_msg.cc)</span></div>
<div class="line"><span class="stringliteral">  target_link_libraries(subscriber_custom_msg</span></div>
<div class="line"><span class="stringliteral">    ${IGNITION-TRANSPORT_LIBRARIES}</span></div>
<div class="line"><span class="stringliteral">    ${PROTO_SRC}</span></div>
<div class="line"><span class="stringliteral">  )</span></div>
<div class="line"><span class="stringliteral">  add_dependencies(subscriber_custom_msg protobuf_compilation)</span></div>
<div class="line"><span class="stringliteral">endif()</span></div>
</div><!-- fragment --><p>In the previous snippet we can see how the binaries are generated. The relevant part is to add a new dependency. We're telling CMake that these two binaries depend on the <code>protobuf_compilation</code> target. This will trigger the recompilation of the binaries if there is any change in our Protobuf messages. Also, we have to link our binaries with the generated Protobuf messages. The list of generated messages are contained in the <code>${PROTO_SRC}</code> variable. Finally, this is the content of the <code>msgs/CMakeLists.txt</code> file:</p>
<div class="fragment"><div class="line">PROTOBUF_GENERATE_CPP(PROTO_SRC PROTO_HEADER</div>
<div class="line">  stringmsg.proto</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Variables needed to propagate through modules</span></div>
<div class="line"><span class="preprocessor"># If more than one layer of cmake use CACHE INTERNAL ...</span></div>
<div class="line">set(PROTOBUF_INCLUDE_DIRS ${PROTOBUF_INCLUDE_DIRS} PARENT_SCOPE)</div>
<div class="line">set(PROTOBUF_LIBRARIES ${PROTOBUF_LIBRARIES} PARENT_SCOPE)</div>
<div class="line">set(PROTO_SRC ${PROTO_SRC} PARENT_SCOPE)</div>
<div class="line">set(PROTO_HEADER ${PROTO_HEADER} PARENT_SCOPE)</div>
<div class="line"> </div>
<div class="line">add_custom_target(protobuf_compilation DEPENDS ${PROTO_SRC})</div>
</div><!-- fragment --><p>The macro <code>PROTOBUF_GENERATE_CPP</code> will use <code>protoc</code> to generate the <code>.pb.h</code> and <code>.pb.cc</code> files from your <code>.proto</code> files. Follow the next instructions to compile and run the generic subscriber example:</p>
<p>Run <code>cmake</code> and build the example:</p>
<div class="fragment"><div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>From terminal 1:</p>
<div class="fragment"><div class="line">./publisher_custom_msg</div>
</div><!-- fragment --><p>From terminal 2:</p>
<div class="fragment"><div class="line">./subscriber_custom_msg</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
Topic remapping</h2>
<p>It's possible to set some global node options that will affect both publishers and subscribers. One of these options is topic remapping. A topic remap consists of a pair of topic names. The first name is the original topic name to be replaced. The second name is the new topic name to use instead. As an example, imagine that you recorded a collection of messages published over topic <code>/foo</code>. Maybe in the future, you want to play back the log file but remapping the topic <code>/foo</code> to <code>/bar</code>. This way, all messages will be published over the <code>/bar</code> topic without having to modify the publisher and create a new log.</p>
<p>We can declare the topic remapping option using the following code:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a transport node and remap a topic.</span></div>
<div class="line">gz::transport::NodeOptions nodeOptions;</div>
<div class="line">nodeOptions.AddTopicRemap(<span class="stringliteral">&quot;/foo&quot;</span>, <span class="stringliteral">&quot;/bar&quot;</span>);</div>
<div class="line">gz::transport::Node node(nodeOptions);</div>
<div class="line"><a class="codeRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> topic = <span class="stringliteral">&quot;/foo&quot;</span>;</div>
</div><!-- fragment --><p>You can modify any of the publisher examples to add this option.</p>
<p>From terminal 1:</p>
<div class="fragment"><div class="line">./publisher</div>
</div><!-- fragment --><p>From terminal 2 (requires Ignition Tools):</p>
<div class="fragment"><div class="line">ign topic --echo -t /bar</div>
</div><!-- fragment --><p>And you should receive all the messages coming in terminal 2.</p>
<p>The command <code>ign log playback</code> also supports the notion of topic remapping. Run <code>ign log playback -h</code> in your terminal for further details (requires Ignition Tools). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="asleep_for_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/thread/sleep_for.html">std::this_thread::sleep_for</a></div><div class="ttdeci">T sleep_for(T... args)</div></div>
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div><div class="ttdoc">STL class.</div></div>
<div class="ttc" id="aduration_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/chrono/duration.html">std::chrono::milliseconds</a></div></div>
<div class="ttc" id="anamespaceignition_1_1transport_html_af38bca501993d613057e1b45e7c1af68"><div class="ttname"><a href="namespaceignition_1_1transport.html#af38bca501993d613057e1b45e7c1af68">ignition::transport::waitForShutdown</a></div><div class="ttdeci">void waitForShutdown()</div><div class="ttdoc">Block the current thread until a SIGINT or SIGTERM is received. Note that this function registers a s...</div></div>
<div class="ttc" id="abasic_ostream_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cerr</a></div></div>
<div class="ttc" id="aatomic_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/atomic/atomic.html">std::atomic</a></div><div class="ttdoc">STL class.</div></div>
<div class="ttc" id="asignal_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/utility/program/signal.html">std::signal</a></div><div class="ttdeci">T signal(T... args)</div></div>
<div class="ttc" id="aendl_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a></div><div class="ttdeci">T endl(T... args)</div></div>
      </div>
    </main>
  </div>
</body>
